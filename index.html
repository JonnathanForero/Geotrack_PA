<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa filtrable por pa√≠s</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
  />
  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { height: 90vh; }
  </style>
</head>
<body>
  <h3>Filtrar por pa√≠s:</h3>
  <select id="paisSelect">
    <option value="todos">Todos</option>
  </select>
  <!-- üîç Aqu√≠ agregamos el buscador por ID -->
  <h4>Buscar por ID:</h4>
  <input type="number" id="idBuscar" placeholder="Buscar por ID">
  <button onclick="buscarPorID()">Buscar</button>
  <div id="map" style="height: 500px;"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([9.1, -79.4], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap'
    }).addTo(map);

    let geojsonLayer;
    let datosOriginales;

    fetch('puntos2.geojson') // <- aseg√∫rate de subir este archivo junto a index.html
      .then(res => res.json())
      .then(data => {
        datosOriginales = data;
        poblarFiltro(data);
        renderizarGeojson(data);
      });

    function poblarFiltro(data) {
      const paises = new Set();
      data.features.forEach(f => paises.add(f.properties.pais));
      const select = document.getElementById('paisSelect');
      paises.forEach(p => {
        const option = document.createElement('option');
        option.value = p;
        option.text = p;
        select.appendChild(option);
      });
      select.addEventListener('change', aplicarFiltro);
    }

    function aplicarFiltro() {
      const valor = document.getElementById('paisSelect').value;
      const filtrados = (valor === 'todos')
        ? datosOriginales
        : {
            ...datosOriginales,
            features: datosOriginales.features.filter(f => f.properties.pais === valor)
          };
      renderizarGeojson(filtrados);
    }

    function renderizarGeojson(data) {
      if (geojsonLayer) geojsonLayer.remove();
      geojsonLayer = L.geoJSON(data, {
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.pais || "Sin nombre");
        }
      }).addTo(map);
    }
    function buscarPorID() {
      
      const idBuscado = document.getElementById('idBuscar').value.trim();
      if (!idBuscado) return;

      const encontrado = datosOriginales.features.find(f => f.properties.id === Number(idBuscado));

      if (encontrado) {
        const coords = encontrado.geometry.coordinates;
        const latlng = [coords[1], coords[0]]; // GeoJSON es [lng, lat], Leaflet usa [lat, lng]

        map.setView(latlng, 14); // zoom al nivel 14

        // Crear popup temporal
        L.popup()
          .setLatLng(latlng)
          .setContent(`<b>ID:</b> ${encontrado.properties.id}<br><b>Pa√≠s:</b> ${encontrado.properties.pais}`)
          .openOn(map);
      } else {
        alert("No se encontr√≥ el ID");
      }
    }


  </script>
</body>
</html>
