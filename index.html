<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa filtrable por país</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link 
    rel="stylesheet" 
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
  />
  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { height: 90vh; }
  </style>
</head>
<body>
  <h3>Filtrar por país:</h3>
  <select id="paisSelect">
    <option value="todos">Todos</option>
  </select>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([9.1, -79.4], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    let geojsonLayer;
    let datosOriginales;

    fetch('puntos.geojson') // <- asegúrate de subir este archivo junto a index.html
      .then(res => res.json())
      .then(data => {
        datosOriginales = data;
        poblarFiltro(data);
        renderizarGeojson(data);
      });

    function poblarFiltro(data) {
      const paises = new Set();
      data.features.forEach(f => paises.add(f.properties.pais));
      const select = document.getElementById('paisSelect');
      paises.forEach(p => {
        const option = document.createElement('option');
        option.value = p;
        option.text = p;
        select.appendChild(option);
      });
      select.addEventListener('change', aplicarFiltro);
    }

    function aplicarFiltro() {
      const valor = document.getElementById('paisSelect').value;
      const filtrados = (valor === 'todos')
        ? datosOriginales
        : {
            ...datosOriginales,
            features: datosOriginales.features.filter(f => f.properties.pais === valor)
          };
      renderizarGeojson(filtrados);
    }

    function renderizarGeojson(data) {
      if (geojsonLayer) geojsonLayer.remove();
      geojsonLayer = L.geoJSON(data, {
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.pais || "Sin nombre");
        }
      }).addTo(map);
    }
  </script>
</body>
</html>
